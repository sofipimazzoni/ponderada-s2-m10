{"version":3,"file":"index.esm.js","sources":["../src/plugin.ts","../src/components/MyGroupsSidebarItem/MyGroupsSidebarItem.tsx"],"sourcesContent":["/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport {\n  createComponentExtension,\n  createPlugin,\n} from '@backstage/core-plugin-api';\nimport { catalogIndexRouteRef } from './routes';\n\n/** @public */\nexport const orgPlugin = createPlugin({\n  id: 'org',\n  externalRoutes: {\n    catalogIndex: catalogIndexRouteRef,\n  },\n});\n\n/** @public */\nexport const EntityGroupProfileCard = orgPlugin.provide(\n  createComponentExtension({\n    name: 'EntityGroupProfileCard',\n    component: {\n      lazy: () => import('./components').then(m => m.GroupProfileCard),\n    },\n  }),\n);\n\n/** @public */\nexport const EntityMembersListCard = orgPlugin.provide(\n  createComponentExtension({\n    name: 'EntityMembersListCard',\n    component: {\n      lazy: () => import('./components').then(m => m.MembersListCard),\n    },\n  }),\n);\n\n/** @public */\nexport const EntityOwnershipCard = orgPlugin.provide(\n  createComponentExtension({\n    name: 'EntityOwnershipCard',\n    component: {\n      lazy: () => import('./components').then(m => m.OwnershipCard),\n    },\n  }),\n);\n\n/** @public */\nexport const EntityUserProfileCard = orgPlugin.provide(\n  createComponentExtension({\n    name: 'EntityUserProfileCard',\n    component: {\n      lazy: () => import('./components').then(m => m.UserProfileCard),\n    },\n  }),\n);\n","/*\n * Copyright 2022 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react';\nimport {\n  DEFAULT_NAMESPACE,\n  stringifyEntityRef,\n} from '@backstage/catalog-model';\nimport {\n  SidebarItem,\n  SidebarSubmenu,\n  SidebarSubmenuItem,\n} from '@backstage/core-components';\nimport {\n  IconComponent,\n  identityApiRef,\n  useApi,\n  useRouteRef,\n} from '@backstage/core-plugin-api';\nimport useAsync from 'react-use/esm/useAsync';\nimport {\n  catalogApiRef,\n  CatalogApi,\n  entityRouteRef,\n} from '@backstage/plugin-catalog-react';\nimport { getCompoundEntityRef } from '@backstage/catalog-model';\n\n/**\n * MyGroupsSidebarItem can be added to your sidebar providing quick access to groups the logged in user is a member of\n *\n * @public\n */\nexport const MyGroupsSidebarItem = (props: {\n  singularTitle: string;\n  pluralTitle: string;\n  icon: IconComponent;\n  filter?: Record<string, string | symbol | (string | symbol)[]>;\n}) => {\n  const { singularTitle, pluralTitle, icon, filter } = props;\n\n  const identityApi = useApi(identityApiRef);\n  const catalogApi: CatalogApi = useApi(catalogApiRef);\n  const catalogEntityRoute = useRouteRef(entityRouteRef);\n\n  const { value: groups } = useAsync(async () => {\n    const profile = await identityApi.getBackstageIdentity();\n\n    const response = await catalogApi.getEntities({\n      filter: [\n        {\n          kind: 'group',\n          'relations.hasMember': profile.userEntityRef,\n          ...(filter ?? {}),\n        },\n      ],\n      fields: ['metadata', 'kind'],\n    });\n\n    return response.items;\n  }, []);\n\n  // Not a member of any groups\n  if (!groups?.length) {\n    return null;\n  }\n\n  // Only member of one group\n  if (groups.length === 1) {\n    const group = groups[0];\n    return (\n      <SidebarItem\n        text={singularTitle}\n        to={catalogEntityRoute(getCompoundEntityRef(group))}\n        icon={icon}\n      />\n    );\n  }\n\n  // Member of more than one group\n  return (\n    <SidebarItem icon={icon} text={pluralTitle}>\n      <SidebarSubmenu title={pluralTitle}>\n        {groups?.map(function groupsMap(group) {\n          return (\n            <SidebarSubmenuItem\n              title={group.metadata.title || group.metadata.name}\n              subtitle={\n                group.metadata.namespace !== DEFAULT_NAMESPACE\n                  ? group.metadata.namespace\n                  : undefined\n              }\n              to={catalogEntityRoute(getCompoundEntityRef(group))}\n              icon={icon}\n              key={stringifyEntityRef(group)}\n            />\n          );\n        })}\n      </SidebarSubmenu>\n    </SidebarItem>\n  );\n};\n"],"names":[],"mappings":"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"}
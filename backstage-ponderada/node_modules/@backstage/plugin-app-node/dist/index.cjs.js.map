{"version":3,"file":"index.cjs.js","sources":["../src/extensions.ts","../src/schema.ts"],"sourcesContent":["/*\n * Copyright 2023 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { createExtensionPoint } from '@backstage/backend-plugin-api';\nimport { ConfigSchema } from '@backstage/config-loader';\nimport { Handler } from 'express';\n\n/**\n * The interface for {@link staticFallbackHandlerExtensionPoint}.\n *\n * @public\n */\nexport interface StaticFallbackHandlerExtensionPoint {\n  /**\n   * Sets the static fallback handler. This can only be done once.\n   */\n  setStaticFallbackHandler(handler: Handler): void;\n}\n\n/**\n * An extension point the exposes the ability to configure a static fallback handler for the app backend.\n *\n * The static fallback handler is a request handler to handle requests for static content that is not\n * present in the app bundle.\n *\n * This can be used to avoid issues with clients on older deployment versions trying to access lazy\n * loaded content that is no longer present. Typically the requests would fall back to a long-term\n * object store where all recently deployed versions of the app are present.\n *\n * Another option is to provide a `database` that will take care of storing the static assets instead.\n *\n * If both `database` and `staticFallbackHandler` are provided, the `database` will attempt to serve\n * static assets first, and if they are not found, the `staticFallbackHandler` will be called.\n *\n * @public\n */\nexport const staticFallbackHandlerExtensionPoint =\n  createExtensionPoint<StaticFallbackHandlerExtensionPoint>({\n    id: 'app.staticFallbackHandler',\n  });\n\n/**\n * The interface for {@link configSchemaExtensionPoint}.\n *\n * @public\n */\nexport interface ConfigSchemaExtensionPoint {\n  /**\n   * Sets the config schema. This can only be done once.\n   */\n  setConfigSchema(configSchema: ConfigSchema): void;\n}\n\n/**\n * An extension point the exposes the ability to override the config schema used by the frontend application.\n *\n * @public\n */\nexport const configSchemaExtensionPoint =\n  createExtensionPoint<ConfigSchemaExtensionPoint>({\n    id: 'app.configSchema',\n  });\n","/*\n * Copyright 2024 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport fs from 'fs-extra';\nimport { resolve as resolvePath } from 'path';\nimport { ConfigSchema, loadConfigSchema } from '@backstage/config-loader';\n\n/**\n * Loads the config schema that is embedded in the frontend build.\n *\n * @public\n */\nexport async function loadCompiledConfigSchema(\n  appDistDir: string,\n): Promise<ConfigSchema | undefined> {\n  const schemaPath = resolvePath(appDistDir, '.config-schema.json');\n  if (await fs.pathExists(schemaPath)) {\n    const serializedSchema = await fs.readJson(schemaPath);\n\n    return await loadConfigSchema({\n      serialized: serializedSchema,\n    });\n  }\n\n  return undefined;\n}\n"],"names":["createExtensionPoint","resolvePath","fs","loadConfigSchema"],"mappings":";;;;;;;;;;;AAiDO,MAAM,sCACXA,qCAA0D,CAAA;AAAA,EACxD,EAAI,EAAA,2BAAA;AACN,CAAC,EAAA;AAmBI,MAAM,6BACXA,qCAAiD,CAAA;AAAA,EAC/C,EAAI,EAAA,kBAAA;AACN,CAAC;;ACjDH,eAAsB,yBACpB,UACmC,EAAA;AACnC,EAAM,MAAA,UAAA,GAAaC,YAAY,CAAA,UAAA,EAAY,qBAAqB,CAAA,CAAA;AAChE,EAAA,IAAI,MAAMC,mBAAA,CAAG,UAAW,CAAA,UAAU,CAAG,EAAA;AACnC,IAAA,MAAM,gBAAmB,GAAA,MAAMA,mBAAG,CAAA,QAAA,CAAS,UAAU,CAAA,CAAA;AAErD,IAAA,OAAO,MAAMC,6BAAiB,CAAA;AAAA,MAC5B,UAAY,EAAA,gBAAA;AAAA,KACb,CAAA,CAAA;AAAA,GACH;AAEA,EAAO,OAAA,KAAA,CAAA,CAAA;AACT;;;;;;"}
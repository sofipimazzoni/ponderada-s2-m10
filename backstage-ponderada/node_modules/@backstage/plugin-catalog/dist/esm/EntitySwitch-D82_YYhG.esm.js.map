{"version":3,"file":"EntitySwitch-D82_YYhG.esm.js","sources":["../../src/components/EntityOrphanWarning/DeleteEntityDialog.tsx","../../src/components/EntityOrphanWarning/EntityOrphanWarning.tsx","../../src/components/EntityRelationWarning/EntityRelationWarning.tsx","../../src/components/EntityProcessingErrorsPanel/EntityProcessingErrorsPanel.tsx","../../src/components/EntitySwitch/EntitySwitch.tsx"],"sourcesContent":["/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Entity } from '@backstage/catalog-model';\nimport { catalogApiRef } from '@backstage/plugin-catalog-react';\nimport Button from '@material-ui/core/Button';\nimport Dialog from '@material-ui/core/Dialog';\nimport DialogActions from '@material-ui/core/DialogActions';\nimport DialogTitle from '@material-ui/core/DialogTitle';\nimport React, { useState } from 'react';\nimport { alertApiRef, useApi } from '@backstage/core-plugin-api';\nimport { assertError } from '@backstage/errors';\n\ninterface DeleteEntityDialogProps {\n  open: boolean;\n  onClose: () => any;\n  onConfirm: () => any;\n  entity: Entity;\n}\n\nexport function DeleteEntityDialog(props: DeleteEntityDialogProps) {\n  const { open, onClose, onConfirm, entity } = props;\n  const [busy, setBusy] = useState(false);\n  const catalogApi = useApi(catalogApiRef);\n  const alertApi = useApi(alertApiRef);\n\n  const onDelete = async () => {\n    setBusy(true);\n    try {\n      const uid = entity.metadata.uid;\n      await catalogApi.removeEntityByUid(uid!);\n      onConfirm();\n    } catch (err) {\n      assertError(err);\n      alertApi.post({ message: err.message });\n    } finally {\n      setBusy(false);\n    }\n  };\n\n  return (\n    <Dialog open={open} onClose={onClose}>\n      <DialogTitle id=\"responsive-dialog-title\">\n        Are you sure you want to delete this entity?\n      </DialogTitle>\n      <DialogActions>\n        <Button\n          variant=\"contained\"\n          color=\"secondary\"\n          disabled={busy}\n          onClick={onDelete}\n        >\n          Delete\n        </Button>\n        <Button onClick={onClose} color=\"primary\">\n          Cancel\n        </Button>\n      </DialogActions>\n    </Dialog>\n  );\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Entity } from '@backstage/catalog-model';\nimport { useEntity } from '@backstage/plugin-catalog-react';\nimport Alert from '@material-ui/lab/Alert';\nimport React, { useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { DeleteEntityDialog } from './DeleteEntityDialog';\nimport { useRouteRef } from '@backstage/core-plugin-api';\nimport { rootRouteRef } from '../../routes';\n\n/**\n * Returns true if the given entity has the orphan annotation given by the\n * catalog.\n *\n * @public\n */\nexport function isOrphan(entity: Entity): boolean {\n  return entity?.metadata?.annotations?.['backstage.io/orphan'] === 'true';\n}\n\n/**\n * Displays a warning alert if the entity is marked as orphan with the ability\n * to delete said entity.\n *\n * @public\n */\nexport function EntityOrphanWarning() {\n  const navigate = useNavigate();\n  const catalogLink = useRouteRef(rootRouteRef);\n  const [confirmationDialogOpen, setConfirmationDialogOpen] = useState(false);\n  const { entity } = useEntity();\n\n  const cleanUpAfterRemoval = async () => {\n    setConfirmationDialogOpen(false);\n    navigate(catalogLink());\n  };\n\n  return (\n    <>\n      <Alert severity=\"warning\" onClick={() => setConfirmationDialogOpen(true)}>\n        This entity is not referenced by any location and is therefore not\n        receiving updates. Click here to delete.\n      </Alert>\n      <DeleteEntityDialog\n        open={confirmationDialogOpen}\n        entity={entity!}\n        onConfirm={cleanUpAfterRemoval}\n        onClose={() => setConfirmationDialogOpen(false)}\n      />\n    </>\n  );\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Entity } from '@backstage/catalog-model';\nimport {\n  CatalogApi,\n  catalogApiRef,\n  useEntity,\n} from '@backstage/plugin-catalog-react';\nimport Alert from '@material-ui/lab/Alert';\nimport React from 'react';\nimport useAsync from 'react-use/esm/useAsync';\nimport Box from '@material-ui/core/Box';\nimport { ResponseErrorPanel } from '@backstage/core-components';\nimport { useApi, ApiHolder } from '@backstage/core-plugin-api';\n\nasync function getRelationWarnings(entity: Entity, catalogApi: CatalogApi) {\n  const entityRefRelations = entity.relations?.map(\n    relation => relation.targetRef,\n  );\n  if (\n    !entityRefRelations ||\n    entityRefRelations?.length < 1 ||\n    entityRefRelations.length > 1000\n  ) {\n    return [];\n  }\n\n  const relatedEntities = await catalogApi.getEntitiesByRefs({\n    entityRefs: entityRefRelations,\n    fields: ['kind', 'metadata.name', 'metadata.namespace'],\n  });\n\n  return entityRefRelations.filter(\n    (_, index) => relatedEntities.items[index] === undefined,\n  );\n}\n\n/**\n * Returns true if the given entity has relations to other entities, which\n * don't exist in the catalog\n *\n * @public\n */\nexport async function hasRelationWarnings(\n  entity: Entity,\n  context: { apis: ApiHolder },\n) {\n  const catalogApi = context.apis.get(catalogApiRef);\n  if (!catalogApi) {\n    throw new Error(`No implementation available for ${catalogApiRef}`);\n  }\n\n  const relatedEntitiesMissing = await getRelationWarnings(entity, catalogApi);\n  return relatedEntitiesMissing.length > 0;\n}\n\n/**\n * Displays a warning alert if the entity has relations to other entities, which\n * don't exist in the catalog\n *\n * @public\n */\nexport function EntityRelationWarning() {\n  const { entity } = useEntity();\n  const catalogApi = useApi(catalogApiRef);\n  const { loading, error, value } = useAsync(async () => {\n    return getRelationWarnings(entity, catalogApi);\n  }, [entity, catalogApi]);\n\n  if (error) {\n    return (\n      <Box mb={1}>\n        <ResponseErrorPanel error={error} />\n      </Box>\n    );\n  }\n\n  if (loading || !value || value.length === 0) {\n    return null;\n  }\n\n  return (\n    <>\n      <Alert severity=\"warning\">\n        This entity has relations to other entities, which can't be found in the\n        catalog. <br />\n        Entities not found are: {value.join(', ')}\n      </Alert>\n    </>\n  );\n}\n","/*\n * Copyright 2021 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { AlphaEntity, EntityStatusItem } from '@backstage/catalog-model/alpha';\nimport { Entity, stringifyEntityRef } from '@backstage/catalog-model';\nimport {\n  catalogApiRef,\n  EntityRefLink,\n  useEntity,\n} from '@backstage/plugin-catalog-react';\nimport Box from '@material-ui/core/Box';\nimport React from 'react';\nimport { ResponseErrorPanel } from '@backstage/core-components';\nimport {\n  CatalogApi,\n  ENTITY_STATUS_CATALOG_PROCESSING_TYPE,\n} from '@backstage/catalog-client';\nimport { useApi, ApiHolder } from '@backstage/core-plugin-api';\nimport useAsync from 'react-use/esm/useAsync';\nimport { SerializedError } from '@backstage/errors';\n\nconst errorFilter = (i: EntityStatusItem) =>\n  i.error &&\n  i.level === 'error' &&\n  i.type === ENTITY_STATUS_CATALOG_PROCESSING_TYPE;\n\ninterface GetOwnAndAncestorsErrorsResponse {\n  items: {\n    errors: SerializedError[];\n    entity: Entity;\n  }[];\n}\n\nasync function getOwnAndAncestorsErrors(\n  entityRef: string,\n  catalogApi: CatalogApi,\n): Promise<GetOwnAndAncestorsErrorsResponse> {\n  const ancestors = await catalogApi.getEntityAncestors({ entityRef });\n  const items = ancestors.items\n    .map(item => {\n      const statuses = (item.entity as AlphaEntity).status?.items ?? [];\n      const errors = statuses\n        .filter(errorFilter)\n        .map(e => e.error)\n        .filter((e): e is SerializedError => Boolean(e));\n      return { errors: errors, entity: item.entity };\n    })\n    .filter(item => item.errors.length > 0);\n  return { items };\n}\n\n/**\n * Returns true if the given entity has any processing errors on it.\n *\n * @public\n */\nexport async function hasCatalogProcessingErrors(\n  entity: Entity,\n  context: { apis: ApiHolder },\n) {\n  const catalogApi = context.apis.get(catalogApiRef);\n  if (!catalogApi) {\n    throw new Error(`No implementation available for ${catalogApiRef}`);\n  }\n\n  const errors = await getOwnAndAncestorsErrors(\n    stringifyEntityRef(entity),\n    catalogApi,\n  );\n  return errors.items.length > 0;\n}\n\n/**\n * Displays a list of errors from the ancestors of the current entity.\n *\n * @public\n */\nexport function EntityProcessingErrorsPanel() {\n  const { entity } = useEntity();\n  const entityRef = stringifyEntityRef(entity);\n  const catalogApi = useApi(catalogApiRef);\n  const { loading, error, value } = useAsync(async () => {\n    return getOwnAndAncestorsErrors(entityRef, catalogApi);\n  }, [entityRef, catalogApi]);\n\n  if (error) {\n    return (\n      <Box mb={1}>\n        <ResponseErrorPanel error={error} />\n      </Box>\n    );\n  }\n\n  if (loading || !value) {\n    return null;\n  }\n\n  return (\n    <>\n      {value.items.map((ancestorError, index) => (\n        <Box key={index} mb={1}>\n          {stringifyEntityRef(entity) !==\n            stringifyEntityRef(ancestorError.entity) && (\n            <Box p={1}>\n              The error below originates from{' '}\n              <EntityRefLink entityRef={ancestorError.entity} />\n            </Box>\n          )}\n          {ancestorError.errors.map((e, i) => (\n            <ResponseErrorPanel key={i} error={e} />\n          ))}\n        </Box>\n      ))}\n    </>\n  );\n}\n","/*\n * Copyright 2020 The Backstage Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Entity } from '@backstage/catalog-model';\nimport { useAsyncEntity } from '@backstage/plugin-catalog-react';\nimport React, { ReactNode, ReactElement } from 'react';\nimport {\n  attachComponentData,\n  useApiHolder,\n  useElementFilter,\n  ApiHolder,\n} from '@backstage/core-plugin-api';\nimport useAsync from 'react-use/esm/useAsync';\n\nconst ENTITY_SWITCH_KEY = 'core.backstage.entitySwitch';\n\n/** @public */\nexport interface EntitySwitchCaseProps {\n  if?: (\n    entity: Entity,\n    context: { apis: ApiHolder },\n  ) => boolean | Promise<boolean>;\n  children: ReactNode;\n}\n\nconst EntitySwitchCaseComponent = (_props: EntitySwitchCaseProps) => null;\n\nattachComponentData(EntitySwitchCaseComponent, ENTITY_SWITCH_KEY, true);\n\ninterface EntitySwitchCase {\n  if?: (\n    entity: Entity,\n    context: { apis: ApiHolder },\n  ) => boolean | Promise<boolean>;\n  children: JSX.Element;\n}\n\ntype SwitchCaseResult = {\n  if?: boolean | Promise<boolean>;\n  children: JSX.Element;\n};\n\n/**\n * Props for the {@link EntitySwitch} component.\n * @public\n */\nexport interface EntitySwitchProps {\n  children: ReactNode;\n  renderMultipleMatches?: 'first' | 'all';\n}\n\n/** @public */\nexport const EntitySwitch = (props: EntitySwitchProps) => {\n  const { entity, loading } = useAsyncEntity();\n  const apis = useApiHolder();\n\n  const results = useElementFilter(\n    props.children,\n    collection =>\n      collection\n        .selectByComponentData({\n          key: ENTITY_SWITCH_KEY,\n          withStrictError: 'Child of EntitySwitch is not an EntitySwitch.Case',\n        })\n        .getElements()\n        .flatMap<SwitchCaseResult>((element: ReactElement) => {\n          if (loading && !entity) {\n            return [];\n          }\n\n          const { if: condition, children: elementsChildren } =\n            element.props as EntitySwitchCase;\n\n          if (!entity) {\n            return [\n              {\n                if: condition === undefined,\n                children: elementsChildren,\n              },\n            ];\n          }\n          return [\n            {\n              if: condition?.(entity, { apis }),\n              children: elementsChildren,\n            },\n          ];\n        }),\n    [apis, entity, loading],\n  );\n\n  const hasAsyncCases = results.some(\n    r => typeof r.if === 'object' && 'then' in r.if,\n  );\n\n  if (hasAsyncCases) {\n    return (\n      <AsyncEntitySwitch\n        results={results}\n        renderMultipleMatches={props.renderMultipleMatches}\n      />\n    );\n  }\n\n  if (props.renderMultipleMatches === 'all') {\n    const children = results.filter(r => r.if).map(r => r.children);\n    if (children.length === 0) {\n      return getDefaultChildren(results);\n    }\n    return <>{children}</>;\n  }\n\n  return results.find(r => r.if)?.children ?? getDefaultChildren(results);\n};\n\nfunction AsyncEntitySwitch({\n  results,\n  renderMultipleMatches,\n}: {\n  results: SwitchCaseResult[];\n  renderMultipleMatches?: 'first' | 'all';\n}) {\n  const { loading, value } = useAsync(async () => {\n    const promises = results.map(\n      async ({ if: condition, children: output }) => {\n        try {\n          if (await condition) {\n            return output;\n          }\n        } catch {\n          /* ignored */\n        }\n        return null;\n      },\n    );\n\n    if (renderMultipleMatches === 'all') {\n      const children = (await Promise.all(promises)).filter(Boolean);\n      if (children.length === 0) {\n        return getDefaultChildren(results);\n      }\n      return <>{children}</>;\n    }\n\n    return (\n      (await Promise.all(promises)).find(Boolean) ?? getDefaultChildren(results)\n    );\n  }, [results]);\n\n  if (loading || !value) {\n    return null;\n  }\n\n  return value;\n}\n\nfunction getDefaultChildren(results: SwitchCaseResult[]) {\n  return results.filter(r => r.if === undefined)[0]?.children ?? null;\n}\n\nEntitySwitch.Case = EntitySwitchCaseComponent;\n"],"names":[],"mappings":"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"}